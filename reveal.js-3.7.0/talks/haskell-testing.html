<!doctype html>
<html lan="en">

    <head>
		<meta charset="utf-8">

		<title>Unit Testing a Haskell Codebase</title>

		<meta name="description" content="How to effectively unit test a large haskell codebase that interacts with many effects">
		<meta name="author" content="Chris Coffey">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="../css/reveal.css">
		<link rel="stylesheet" href="../css/theme/night.css" id="theme">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="../lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? '../css/print/pdf.css' : '../css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

    <body>
        <div class="reveal">
            <div class="slides">
                <!-- Title slides -->
                <section>
                    <h2>Unit Testing in Haskell</h2>
                    <h5>its easier than you think!</h5>
                </section>

                <section>
                    <h2>Agenda</h3>
                    <ul>
                        <li>Testing Pure Code</li>
                        <li>Assertions vs. Properties</li>
                        <li>Structuring Code For Testability</li>
                        <li>Mocking via TypeClasses</li>
                    </ul>
                </section>

                <!-- Testing a pure function -->
                <section>
                    <section>
                        <h3>Testing Pure Code</h3>
                        <p>
                        How would you test this?
                        </p>
                        <pre><code class="hljs">
makeUsPhoneNumber ::
    T.Text -- ^ the raw phone number
    -> Maybe UsPhoneNumber
makeUsPhoneNumber num
    | isJust $ T.find isLetter num = Nothing
    | otherwise =
        case chopToLength $ toDigits num of
            num' | properNumber num' -> Just $ UsPhoneNumber num'
            _ -> Nothing
        where
            toDigits = T.filter isDigit
            chopToLength = T.reverse . T.take 10 . T.reverse
            properNumber = (==) 10 . T.length

                            </code></pre>
                    </section>
                    <section>
                        <h3>Testing Pure Code</h3>
                        <p>Positive &amp; Negative test cases?</p>
                        <pre><code class="hljs">
    | isJust $ T.find isLetter num = Nothing
                        </code></pre>
                        <p>Obviously can' have letters, so "123456a890" should fail</p>
                    </section>
                    <section>
                        <h3>Testing Pure Code</h3>
                        <p>Using Tasty and HUnit</p>
                        <pre><code class="hljs">
    testCase "Rejects inputs with letters" $ let
        l1 = "123456a890"
        l2 = "ABC123defa"
        l3 = "this is a full sentence"
        res = makeUsPhoneNumber <$> [l1, l2, l3]
        in all isNothing res @?= True
                        </code class="hljs"></pre>
                    </section>

                </section>

                <section>
                    <section>
                        <h3>Properties & Assertions</h3>
                        <p>Assertions test specific propeties of specific input values. Quick to write and easy to visually verrify. Only as exhaustive as the developer writing the test.
                        </p>
                        <p>Properties test general conditions for arbitrary input values. Think of it as a set of pre/post-conditions on your function.  These take a long time to write and are easy to get wrong by re-implementing the body of your function in the pre/post-conditions. Quite exhaustive.
                        </p>
                    </section>
                    <section>
                        <h3>Properties & Assertions</h3>
                        <p>QuickCheck via Tasty</p>
                        <pre><code class="hljs">
testProperty "nextPageInList" $ do
    property "gets the empty paged list given an empty list" $
        \maybePageIdentifier ->
            nextPageInList (fmap getPositive maybePageIdentifier) emptyPages
                == emptyPagedList
                        <code></pre>
                        <p>Relies on the <em style="color: green;">Testable</em> class from Test.QuickCheck</p>
                    </section>
                </section>
            </div>
        </div>
    </body>

    <script src="../lib/js/head.min.js"></script>
    <script src="../js/reveal.js"></script>

    <script>

        // More info https://github.com/hakimel/reveal.js#configuration
        Reveal.initialize({
            controls: true,
            progress: true,
            history: true,
            center: true,

            transition: 'slide', // none/fade/slide/convex/concave/zoom

            // More info https://github.com/hakimel/reveal.js#dependencies
            dependencies: [
                { src: '../lib/js/classList.js', condition: function() { return !document.body.classList; } },
                { src: '../plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                { src: '../plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                { src: '../plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                { src: '../plugin/search/search.js', async: true },
                { src: '../plugin/zoom-js/zoom.js', async: true },
                { src: '../plugin/notes/notes.js', async: true }
            ]
        });

    </script>

</html>
